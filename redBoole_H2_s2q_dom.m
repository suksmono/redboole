%% use symbolic computation for Boolean reduction
% s={-1,1}; q={0,1}
% keep in mind that boolean reduction works on q-domain
% case: H2=[q1 q2; q3 q4], off-diagonal term is d12
clear all;
addpath functions;
syms q1 q2 q3 q4 q5 q6; % define boolean variables and functions
%% step-1: work in s-domain 
% ==> d12=s1*s3 + s2*s4 ;
syms s1 s2 s3 s4 s5 s6;
d12=s1*s3 + s2*s4 ; 
d12_2=expand(d12^2);
%% change all si^2 to 1
d12_2s=simplify( ...
                 subs(d12_2, ...
                 {s1^2, s2^2, s3^2, s4^2}, ...
                 {1, 1, 1, 1} ...
                 ) ...
             );            
disp(sprintf('d12^2 in s-domain: \n%s',char(d12_2s)));
%% convert to q domain
d12_2q=expand(simplify( ...
                subs(d12_2s, ...
                {s1, s2, s3, s4}, ...
                {s2q(q1), s2q(q2),s2q(q3),s2q(q4)}...
                )...
            ));
disp(sprintf('d12^2 k-body in q-domain: \n%s',...
    char(d12_2q)));
%%
% Hkq =  8*q1*q2 - 4*q2 - 4*q3 - 4*q4 - 4*q1 
%   + 8*q1*q3 + 8*q1*q4 + 8*q2*q3 + 8*q2*q4 + 8*q3*q4 
%   - 16*q1*q2*q3 - 16*q1*q2*q4 - 16*q1*q3*q4 - 16*q2*q3*q4 
%   + 32*q1*q2*q3*q4 + 4

%% convert to 2-body H2q
% q1*q2->q5, q3*q4->q6; choose delta=2*Hmax = 8
d5=8; d6=8;
d12_2q2b = simplify( ...
            subs(d12_2q, ...
                {q1*q2, q3*q4}, ...
                {q5, q6}...
                )...
            + H2body(q1,q2,q5,d5) ...
            + H2body(q3,q4,q6,d6) ...
            );
disp(sprintf('d12^2 2-body in q-domain: \n%s',...
    char(expand(d12_2q2b))));
%% RESULTS
% 32*q5 - 4*q2 - 4*q3 - 4*q4 - 4*q1 + 32*q6 
% + 8*q1*q2 + 8*q1*q3 + 8*q1*q4 + 8*q2*q3 - 16*q1*q5 + 8*q2*q4 
% - 16*q1*q6 - 16*q2*q5 + 8*q3*q4 - 16*q2*q6 - 16*q3*q5 
% - 16*q3*q6 - 16*q4*q5 - 16*q4*q6 + 32*q5*q6 + 4

%% CHECK Range consistencies 

vbin4=[ ...
        0 0 0 0 0 0;
        0 0 0 0 0 1;
        0 0 0 0 1 0;
        0 0 0 0 1 1;
        0 0 0 1 0 0;
        0 0 0 1 0 1;
        0 0 0 1 1 0;
        0 0 0 1 1 1;
        0 0 1 0 0 0;
        0 0 1 0 0 1;
        0 0 1 0 1 0;
        0 0 1 0 1 1;
        0 0 1 1 0 0;
        0 0 1 1 0 1;
        0 0 1 1 1 0;
        0 0 1 1 1 1;

        0 1 0 0 0 0;
        0 1 0 0 0 1;
        0 1 0 0 1 0;
        0 1 0 0 1 1;
        0 1 0 1 0 0;
        0 1 0 1 0 1;
        0 1 0 1 1 0;
        0 1 0 1 1 1;
        0 1 1 0 0 0;
        0 1 1 0 0 1;
        0 1 1 0 1 0;
        0 1 1 0 1 1;
        0 1 1 1 0 0;
        0 1 1 1 0 1;
        0 1 1 1 1 0;
        0 1 1 1 1 1;
        
        1 0 0 0 0 0;
        1 0 0 0 0 1;
        1 0 0 0 1 0;
        1 0 0 0 1 1;
        1 0 0 1 0 0;
        1 0 0 1 0 1;
        1 0 0 1 1 0;
        1 0 0 1 1 1;
        1 0 1 0 0 0;
        1 0 1 0 0 1;
        1 0 1 0 1 0;
        1 0 1 0 1 1;
        1 0 1 1 0 0;
        1 0 1 1 0 1;
        1 0 1 1 1 0;
        1 0 1 1 1 1;

        1 1 0 0 0 0;
        1 1 0 0 0 1;
        1 1 0 0 1 0;
        1 1 0 0 1 1;
        1 1 0 1 0 0;
        1 1 0 1 0 1;
        1 1 0 1 1 0;
        1 1 0 1 1 1;
        1 1 1 0 0 0;
        1 1 1 0 0 1;
        1 1 1 0 1 0;
        1 1 1 0 1 1;
        1 1 1 1 0 0;
        1 1 1 1 0 1;
        1 1 1 1 1 0;
        1 1 1 1 1 1;
];

for m=1:2^6
    v4=vbin4(m,3:6);
    v6=vbin4(m,:);
    E2qkb=subs(d12_2q, ...
        {q1, q2, q3, q4}, ...
        {v4(1), v4(2),v4(3),v4(4)} ...
        );
    E2q2b=subs(d12_2q2b, ...
        {q1, q2, q3, q4, q5, q6}, ...
        {v6(3), v6(4),v6(5),v6(6), v6(1), v6(2)} ...
        );
%         {v6(3), v6(4),v6(5),v6(6), v6(1), v6(2)} ...
%         {v6(1), v6(2),v6(3),v6(4), v6(5), v6(6)} ...
    disp(sprintf('%g%g %g%g%g%g |%2g%2g %2g%2g%2g%2g -> Ekbq:%g, E2bq:%g',...
         v6(1), v6(2),v6(3),v6(4),v6(5),v6(6), ...
         vq2s(v6(1)), vq2s(v6(2)),vq2s(v6(3)),vq2s(v6(4)),vq2s(v6(5)),vq2s(v6(6)), ...
         double(E2qkb), double(E2q2b) ));
end;
%% 4 variables output:
% 0000 | 1 1 1 1 -> 4
% 0001 | 1 1 1-1 -> 0
% 0010 | 1 1-1 1 -> 0
% 0011 | 1 1-1-1 -> 4
% 0100 | 1-1 1 1 -> 0
% 0101 | 1-1 1-1 -> 4
% 0110 | 1-1-1 1 -> 4
% 0111 | 1-1-1-1 -> 0
% 1000 |-1 1 1 1 -> 0
% 1001 |-1 1 1-1 -> 4
% 1010 |-1 1-1 1 -> 4
% 1011 |-1 1-1-1 -> 0
% 1100 |-1-1 1 1 -> 4
% 1101 |-1-1 1-1 -> 0
% 1110 |-1-1-1 1 -> 0
% 1111 |-1-1-1-1 -> 4
%--> consistent

%% 6-variables
% 00 0000 | 1 1  1 1 1 1 -> Ekbq:4, E2bq:4
% 00 0001 | 1 1  1 1 1-1 -> Ekbq:0, E2bq:0
% 00 0010 | 1 1  1 1-1 1 -> Ekbq:0, E2bq:0
% 00 0011 | 1 1  1 1-1-1 -> Ekbq:4, E2bq:4
% 00 0100 | 1 1  1-1 1 1 -> Ekbq:0, E2bq:0
% 00 0101 | 1 1  1-1 1-1 -> Ekbq:4, E2bq:4
% 00 0110 | 1 1  1-1-1 1 -> Ekbq:4, E2bq:4
% 00 0111 | 1 1  1-1-1-1 -> Ekbq:0, E2bq:16
% 00 1000 | 1 1 -1 1 1 1 -> Ekbq:0, E2bq:0
% 00 1001 | 1 1 -1 1 1-1 -> Ekbq:4, E2bq:4
% 00 1010 | 1 1 -1 1-1 1 -> Ekbq:4, E2bq:4
% 00 1011 | 1 1 -1 1-1-1 -> Ekbq:0, E2bq:16
% 00 1100 | 1 1 -1-1 1 1 -> Ekbq:4, E2bq:4
% 00 1101 | 1 1 -1-1 1-1 -> Ekbq:0, E2bq:16
% 00 1110 | 1 1 -1-1-1 1 -> Ekbq:0, E2bq:16
% 00 1111 | 1 1 -1-1-1-1 -> Ekbq:4, E2bq:36
% 01 0000 | 1-1  1 1 1 1 -> Ekbq:4, E2bq:36
% 01 0001 | 1-1  1 1 1-1 -> Ekbq:0, E2bq:16
% 01 0010 | 1-1  1 1-1 1 -> Ekbq:0, E2bq:16
% 01 0011 | 1-1  1 1-1-1 -> Ekbq:4, E2bq:4
% 01 0100 | 1-1  1-1 1 1 -> Ekbq:0, E2bq:16
% 01 0101 | 1-1  1-1 1-1 -> Ekbq:4, E2bq:4
% 01 0110 | 1-1  1-1-1 1 -> Ekbq:4, E2bq:4
% 01 0111 | 1-1  1-1-1-1 -> Ekbq:0, E2bq:0
% 01 1000 | 1-1 -1 1 1 1 -> Ekbq:0, E2bq:16
% 01 1001 | 1-1 -1 1 1-1 -> Ekbq:4, E2bq:4
% 01 1010 | 1-1 -1 1-1 1 -> Ekbq:4, E2bq:4
% 01 1011 | 1-1 -1 1-1-1 -> Ekbq:0, E2bq:0
% 01 1100 | 1-1 -1-1 1 1 -> Ekbq:4, E2bq:4
% 01 1101 | 1-1 -1-1 1-1 -> Ekbq:0, E2bq:0
% 01 1110 | 1-1 -1-1-1 1 -> Ekbq:0, E2bq:0
% 01 1111 | 1-1 -1-1-1-1 -> Ekbq:4, E2bq:4
% 10 0000 |-1 1  1 1 1 1 -> Ekbq:4, E2bq:36
% 10 0001 |-1 1  1 1 1-1 -> Ekbq:0, E2bq:16
% 10 0010 |-1 1  1 1-1 1 -> Ekbq:0, E2bq:16
% 10 0011 |-1 1  1 1-1-1 -> Ekbq:4, E2bq:4
% 10 0100 |-1 1  1-1 1 1 -> Ekbq:0, E2bq:16
% 10 0101 |-1 1  1-1 1-1 -> Ekbq:4, E2bq:4
% 10 0110 |-1 1  1-1-1 1 -> Ekbq:4, E2bq:4
% 10 0111 |-1 1  1-1-1-1 -> Ekbq:0, E2bq:0
% 10 1000 |-1 1 -1 1 1 1 -> Ekbq:0, E2bq:16
% 10 1001 |-1 1 -1 1 1-1 -> Ekbq:4, E2bq:4
% 10 1010 |-1 1 -1 1-1 1 -> Ekbq:4, E2bq:4
% 10 1011 |-1 1 -1 1-1-1 -> Ekbq:0, E2bq:0
% 10 1100 |-1 1 -1-1 1 1 -> Ekbq:4, E2bq:4
% 10 1101 |-1 1 -1-1 1-1 -> Ekbq:0, E2bq:0
% 10 1110 |-1 1 -1-1-1 1 -> Ekbq:0, E2bq:0
% 10 1111 |-1 1 -1-1-1-1 -> Ekbq:4, E2bq:4
% 11 0000 |-1-1  1 1 1 1 -> Ekbq:4, E2bq:100
% 11 0001 |-1-1  1 1 1-1 -> Ekbq:0, E2bq:64
% 11 0010 |-1-1  1 1-1 1 -> Ekbq:0, E2bq:64
% 11 0011 |-1-1  1 1-1-1 -> Ekbq:4, E2bq:36
% 11 0100 |-1-1  1-1 1 1 -> Ekbq:0, E2bq:64
% 11 0101 |-1-1  1-1 1-1 -> Ekbq:4, E2bq:36
% 11 0110 |-1-1  1-1-1 1 -> Ekbq:4, E2bq:36
% 11 0111 |-1-1  1-1-1-1 -> Ekbq:0, E2bq:16
% 11 1000 |-1-1 -1 1 1 1 -> Ekbq:0, E2bq:64
% 11 1001 |-1-1 -1 1 1-1 -> Ekbq:4, E2bq:36
% 11 1010 |-1-1 -1 1-1 1 -> Ekbq:4, E2bq:36
% 11 1011 |-1-1 -1 1-1-1 -> Ekbq:0, E2bq:16
% 11 1100 |-1-1 -1-1 1 1 -> Ekbq:4, E2bq:36
% 11 1101 |-1-1 -1-1 1-1 -> Ekbq:0, E2bq:16
% 11 1110 |-1-1 -1-1-1 1 -> Ekbq:0, E2bq:16
% 11 1111 |-1-1 -1-1-1-1 -> Ekbq:4, E2bq:4
%%all minima of E2bq consistent with Ekbq, 
% but not all the minima of Ekbq corresponds to E2bq
% consequences: not all minimas are found, but it's okey
% compared to false minima
